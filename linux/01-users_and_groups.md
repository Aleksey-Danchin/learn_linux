# Конспект: Пользователи, группы, команды и сценарии использования

## Основные понятия

- **Пользователь** — сущность, имеющая уникальный UID.
- **Группа** — объединение пользователей с уникальным GID.
- **Основная группа** — назначена по умолчанию пользователю.
- **Дополнительные группы** — расширяют права доступа.
- **root** — суперпользователь (UID 0).
- **Системные пользователи и группы** — используются службами и процессами.

---

## Ключевые файлы и форматы записей

### `/etc/passwd`

Содержит основные сведения о пользователях.
Формат:

```
username:password_placeholder:UID:GID:comment:home:shell
```

- **username** — имя пользователя.
- **password_placeholder** — символ `x` или `*`, если пароль хранится в `/etc/shadow`.
- **UID** — уникальный идентификатор пользователя.
- **GID** — идентификатор основной группы пользователя.
- **comment** — дополнительная информация (GECOS-поле).
- **home** — путь к домашнему каталогу.
- **shell** — путь к оболочке пользователя.

---

### `/etc/shadow`

Хранит защищённые хэши паролей и политику их изменения.
Формат:

```
username:password_hash:last_change:min:max:warn:inactive:expire
```

- **username** — имя пользователя.
- **password_hash** — хэш пароля или специальные значения:

  - `!` — аккаунт заблокирован.
  - `*` — вход с паролем невозможен.

- **last_change** — дата последней смены пароля (в днях с 1.1.1970).
- **min** — минимальное число дней до смены пароля.
- **max** — максимальное число дней действия пароля.
- **warn** — за сколько дней предупреждать о смене.
- **inactive** — дни после истечения пароля до блокировки.
- **expire** — дата истечения аккаунта.

---

### `/etc/group`

Содержит список групп и их участников.
Формат:

```
groupname:password_placeholder:GID:user_list
```

- **groupname** — имя группы.
- **password_placeholder** — пароль группы (обычно `x` или пусто).
- **GID** — уникальный идентификатор группы.
- **user_list** — список участников группы через запятую.

---

### `/etc/gshadow`

Хранит защищённую информацию о группах.
Формат:

```
groupname:password:admins:members
```

- **groupname** — имя группы.
- **password** — хэш пароля группы.
- **admins** — список администраторов группы.
- **members** — список обычных участников.

---

## Команды управления пользователями

### Создание

- `useradd` — создать пользователя.
- `adduser` — интерактивное создание пользователя.

### Изменение

- `usermod -aG group user` — добавить пользователя в группу.
- `usermod -s /bin/shell user` — сменить shell пользователя.
- `passwd user` — сменить пароль.
- `chfn` — изменить информацию о пользователе.
- `chsh` — сменить shell пользователя.

### Удаление

- `userdel user` — удалить пользователя.
- `userdel -r user` — удалить с домашним каталогом.

---

## Команды управления группами

### Создание

- `groupadd` — создать группу.

### Изменение

- `groupmod -n newname oldname` — переименовать группу.
- `gpasswd` — управлять членством и паролями групп.

### Удаление

- `groupdel` — удалить группу.

---

## Информационные команды

- `id` — показать UID, GID и группы.
- `whoami` — показать имя текущего пользователя.
- `groups` — показать группы текущего пользователя.
- `getent passwd` — список пользователей.
- `getent group` — список групп.
- `finger user` — подробная информация о пользователе.
- `last` — история входов пользователей.
- `who` — список вошедших пользователей.
- `w` — кто в системе и чем занят.
- `lslogins` — информация о пользователях и входах.

---

## Работа с `su`

- **Назначение:** временная смена пользователя в текущей сессии.
- **Синтаксис:**

```
su [опции] [имя_пользователя]
```

- Если имя пользователя не указано — по умолчанию `root`.
- При смене на другого пользователя потребуется его пароль (в отличие от `sudo`).

### Опции:

- `-` или `-l` — полная сессия входа (загрузка окружения, как при обычном входе).
- `-c "команда"` — выполнить команду от имени пользователя и вернуться.
- `-s /bin/shell` — указать альтернативную оболочку.

### Примеры:

1. Перейти в сессию root с окружением:

```
su -
```

2. Выполнить команду от имени другого пользователя:

```
su - alice -c "ls -la"
```

3. Использовать другой shell:

```
su -s /bin/zsh alice
```

---

## Сценарии использования

1. **Создать пользователя:**

```
sudo adduser alice
```

2. **Создать группу и добавить туда пользователя:**

```
sudo groupadd developers
sudo usermod -aG developers alice
```

3. **Посмотреть все группы, где есть пользователь:**

```
id alice
groups alice
```

4. **Назначить пользователю новый shell:**

```
sudo usermod -s /bin/zsh alice
```

5. **Временно сменить группу в текущей сессии:**

```
newgrp developers
```

6. **Переключиться на другого пользователя:**

```
su - bob
```

7. **Удалить пользователя и его домашний каталог:**

```
sudo userdel -r alice
```

---

## Полезные и базовые утилиты

- `vipw` — безопасное редактирование /etc/passwd.
- `vigr` — безопасное редактирование /etc/group.
- `users` — вывести список пользователей в системе.
- `logname` — показать имя вошедшего пользователя.
- `stat` — подробная информация о файле/директории.
- `namei` — показать владельца и права доступа для каждого уровня пути.
- `getfacl` / `setfacl` — просмотр и управление ACL.
- `lslogins` — информация о пользователях в системе.
- `chage` — управление сроком действия пароля пользователя.
- `faillog` — просмотр и сброс неудачных попыток входа.
- `pwck`, `grpck` — проверка целостности файлов /etc/passwd и /etc/group.
- `grep` с `getent` — поиск конкретных пользователей/групп.

---
